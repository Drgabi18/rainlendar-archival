<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>packetbuffer.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.7 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>packetbuffer.h</h1><a href="packetbuffer_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/********************************************************************</font>
00002 <font class="comment">        Copyright (c) 2001, Lee Patterson &amp; Ant Works Software</font>
00003 <font class="comment">        http://ssobjects.sourceforge.net</font>
00004 <font class="comment"></font>
00005 <font class="comment">        created  :  5/24/1999</font>
00006 <font class="comment">        filename :  packet.h</font>
00007 <font class="comment">        author   :  Lee Patterson (lee@antws.com)</font>
00008 <font class="comment">        </font>
00009 <font class="comment">        purpose  :  Packet class for sending data over sockets</font>
00010 <font class="comment">                </font>
00011 <font class="comment">*********************************************************************/</font>
00012 
00013 <font class="preprocessor">#ifndef PACKETBUFFER_H</font>
<a name="l00014"></a><a class="code" href="packetbuffer_8h.html#a0">00014</a> <font class="preprocessor"></font><font class="preprocessor">#define PACKETBUFFER_H</font>
00015 <font class="preprocessor"></font>
00016 <font class="preprocessor">#include &lt;time.h&gt;</font>
00017 <font class="preprocessor">#include "<a class="code" href="defs_8h.html">defs.h</a>"</font>
00018 <font class="preprocessor">#include "<a class="code" href="generalexception_8h.html">generalexception.h</a>"</font>
00019 <font class="preprocessor">#include "<a class="code" href="logs_8h.html">logs.h</a>"</font>
00020 
00021 
00022 <font class="keyword">namespace </font>ssobjects
00023 {
00024 
00025 
00026 <font class="keyword">class </font>ClientConnector;
00027 <font class="keyword">class </font>BufferedSocket;
00028 <font class="keyword">class </font>PacketBuffer;
00029 <font class="keyword">class </font>Communicable;
00030 
00031 <font class="comment">//typedefs for static headerSize function can get the correct size</font>
00032 
<a name="l00033"></a><a class="code" href="packetbuffer_8h.html#a1">00033</a> <font class="preprocessor">#define typeCookie unsigned16</font>
<a name="l00034"></a><a class="code" href="packetbuffer_8h.html#a2">00034</a> <font class="preprocessor"></font><font class="preprocessor">#define typeBufferSize unsigned32</font>
<a name="l00035"></a><a class="code" href="packetbuffer_8h.html#a3">00035</a> <font class="preprocessor"></font><font class="preprocessor">#define typeCommand unsigned16</font>
00036 <font class="preprocessor"></font>
00044 <font class="comment">//TODO: need a copy construtor</font>
<a name="l00045"></a><a class="code" href="classssobjects_1_1PacketBufferHeader.html">00045</a> <font class="keyword">class </font>PacketBufferHeader
00046 {
00047     <font class="keyword">friend</font> PacketBuffer;
00048     <font class="keyword">friend</font> Communicable;
00049   <font class="keyword">public</font>:
00050     <font class="comment">//header block starts here --&gt;</font>
<a name="l00051"></a><a class="code" href="classssobjects_1_1PacketBufferHeader.html#m0">00051</a>     typeBufferSize  m_nBufferSize;        
<a name="l00052"></a><a class="code" href="classssobjects_1_1PacketBufferHeader.html#m1">00052</a>     typeCookie      m_wCookie;            
<a name="l00053"></a><a class="code" href="classssobjects_1_1PacketBufferHeader.html#m2">00053</a>     typeCommand     m_wCommand;           
00054     <font class="comment">// &lt;--</font>
<a name="l00055"></a><a class="code" href="classssobjects_1_1PacketBufferHeader.html#p0">00055</a>     <font class="keyword">static</font> unsigned32 m_nMaxPacketSize;   
<a name="l00056"></a><a class="code" href="classssobjects_1_1PacketBufferHeader.html#m3">00056</a>     <font class="keywordtype">bool</font>        m_bNetworkReady;          
00057   <font class="keyword">public</font>:
<a name="l00058"></a><a class="code" href="classssobjects_1_1PacketBufferHeader.html#a0">00058</a>     <a class="code" href="classssobjects_1_1PacketBufferHeader.html#a0">PacketBufferHeader</a>() : m_nBufferSize(0),m_wCookie(0),m_wCommand(0),m_bNetworkReady(false){};
<a name="l00059"></a><a class="code" href="classssobjects_1_1PacketBufferHeader.html#a1">00059</a>     <a class="code" href="classssobjects_1_1PacketBufferHeader.html#a0">PacketBufferHeader</a>(unsigned16 wCommand,unsigned16 wCookie) : m_nBufferSize(0),m_wCookie(wCookie),m_wCommand(wCommand),m_bNetworkReady(false){};
00060     <font class="keywordtype">void</font>        <a class="code" href="classssobjects_1_1PacketBufferHeader.html#a2">makeNetworkReady</a>(<font class="keywordtype">bool</font> bOverrideFailsave=<font class="keyword">false</font>);         
00061     <font class="keywordtype">void</font>        <a class="code" href="classssobjects_1_1PacketBufferHeader.html#a3">makeHostReady</a>(<font class="keywordtype">bool</font> bOverrideFailsafe=<font class="keyword">false</font>);            
<a name="l00062"></a><a class="code" href="classssobjects_1_1PacketBufferHeader.html#a4">00062</a>     unsigned8*  <a class="code" href="classssobjects_1_1PacketBufferHeader.html#a4">getHeader</a>()<font class="keyword"> const </font>{<font class="keywordflow">return</font> (unsigned8*)&amp;m_nBufferSize;}  
<a name="l00063"></a><a class="code" href="classssobjects_1_1PacketBufferHeader.html#a5">00063</a>     unsigned32  <a class="code" href="classssobjects_1_1PacketBufferHeader.html#a5">getBufferSize</a>()<font class="keyword"> const </font>{<font class="keywordflow">return</font> m_nBufferSize;}           
<a name="l00064"></a><a class="code" href="classssobjects_1_1PacketBufferHeader.html#a6">00064</a>     unsigned16  <a class="code" href="classssobjects_1_1PacketBufferHeader.html#a6">getCookie</a>()<font class="keyword"> const </font>{<font class="keywordflow">return</font> m_wCookie;}                   
<a name="l00065"></a><a class="code" href="classssobjects_1_1PacketBufferHeader.html#a7">00065</a>     unsigned16  <a class="code" href="classssobjects_1_1PacketBufferHeader.html#a7">getCmd</a>()<font class="keyword"> const </font>{<font class="keywordflow">return</font> m_wCommand;}                     
00066     <font class="keywordtype">void</font>        <a class="code" href="classssobjects_1_1PacketBufferHeader.html#a8">reset</a>();                                                
00067     <font class="keywordtype">bool</font>        <a class="code" href="classssobjects_1_1PacketBufferHeader.html#a9">isValid</a>();                                              
<a name="l00068"></a><a class="code" href="classssobjects_1_1PacketBufferHeader.html#a10">00068</a>     <font class="keywordtype">bool</font>        <a class="code" href="classssobjects_1_1PacketBufferHeader.html#a10">isNetworkReady</a>()<font class="keyword"> const </font>{<font class="keywordflow">return</font> m_bNetworkReady;}        
00069 
00070     <font class="keyword">static</font>      unsigned32 <a class="code" href="classssobjects_1_1PacketBufferHeader.html#d0">getMaxPacketSize</a>();                          
00071     <font class="keyword">static</font>      unsigned32 <a class="code" href="classssobjects_1_1PacketBufferHeader.html#d1">setMaxPacketSize</a>(unsigned32);                
<a name="l00072"></a><a class="code" href="classssobjects_1_1PacketBufferHeader.html#d2">00072</a>     <font class="keyword">static</font> unsigned32  <a class="code" href="classssobjects_1_1PacketBufferHeader.html#d2">getSize</a>()<font class="keyword"> </font>
00073 <font class="keyword">    </font>{<font class="keywordflow">return</font> <font class="keyword">sizeof</font>(typeBufferSize)+<font class="keyword">sizeof</font>(typeCookie)+<font class="keyword">sizeof</font>(typeCommand);} 
00074 };
00075 
<a name="l00110"></a><a class="code" href="classssobjects_1_1PacketBuffer.html">00110</a> <font class="keyword">class </font>PacketBuffer 
00111 {
00112   <font class="keyword">public</font>:
00142     <font class="keyword">enum</font>    <font class="comment">//standard commands</font>
00143       {
00144       pcInvalid=0,        
00145       pcLogin,            
00146       pcLoginOkay,        
00147       pcLoginBad,         
00148       pcLogout,           
00149       pcGetVersion,       
00150       pcVersion,          
00151       pcPing,             
00152       pcPong,             
00153       pcStatus,           
00154       pcNetFileStart,     
00155       pcNetFileData,      
00156       pcNetFileEnd,       
00157       pcClosed,           
00158       pcNewConnection,    
00159       pcAuthenticate,     
00160       pcAuthReply,        
00161 
00162       <font class="comment">//debugging packets</font>
00163       pcNoop=100,         
00164 
00165       pcUser=256,         
00166       };
00167 
00168     <font class="keyword">enum</font> 
00169       {
00170       pkCookie=0x4C50                 
00171       }; 
00172     <font class="keyword">enum</font> 
00173       {
00174       DefaultPacketBufferSize=1000    
00175       };  
00176 
00177     <font class="comment">//TODO: packet header should be protected but isn't as I need the info in the servsocket class, and hadn't thought of making it a friend till now :)</font>
<a name="l00178"></a><a class="code" href="classssobjects_1_1PacketBuffer.html#m0">00178</a>     PacketBufferHeader  m_packetHeader;             
00179   <font class="keyword">protected</font>:
<a name="l00180"></a><a class="code" href="classssobjects_1_1PacketBuffer.html#n0">00180</a>     unsigned8*      m_Buffer;                   
00181 
<a name="l00182"></a><a class="code" href="classssobjects_1_1PacketBuffer.html#n1">00182</a>     unsigned8*      m_pPointer;                 
<a name="l00183"></a><a class="code" href="classssobjects_1_1PacketBuffer.html#n2">00183</a>     <font class="keywordtype">bool</font>            m_bUsed;                    
<a name="l00184"></a><a class="code" href="classssobjects_1_1PacketBuffer.html#n3">00184</a>     unsigned32      m_nID;                      
<a name="l00185"></a><a class="code" href="classssobjects_1_1PacketBuffer.html#n4">00185</a>     unsigned32      m_nBufferSizeMax;           
00186 
00187     <font class="comment">//static data</font>
<a name="l00188"></a><a class="code" href="classssobjects_1_1PacketBuffer.html#q0">00188</a>     <font class="keyword">static</font>  unsigned32    m_nUniqueID;          
00189 
00190     <font class="comment">//static methods</font>
00191   <font class="keyword">public</font>:
<a name="l00192"></a><a class="code" href="classssobjects_1_1PacketBuffer.html#d0">00192</a>     <font class="keyword">static</font> unsigned32     <a class="code" href="classssobjects_1_1PacketBuffer.html#d0">getHeaderSize</a>()<font class="keyword">     </font>{<font class="keywordflow">return</font> PacketBufferHeader::getSize();}
00193     <font class="keyword">virtual</font> <font class="keywordtype">void</font> <a class="code" href="classssobjects_1_1PacketBuffer.html#a0">makeNetworkReady</a>(<font class="keywordtype">bool</font> bOverrideFailsave=<font class="keyword">false</font>);        
00194     <font class="keyword">virtual</font> <font class="keywordtype">void</font> <a class="code" href="classssobjects_1_1PacketBuffer.html#a1">makeHostReady</a>(<font class="keywordtype">bool</font> bOverrideFailsave=<font class="keyword">false</font>);           
00195         
00196     <font class="comment">//friend methods</font>
00197   <font class="keyword">protected</font>:
<a name="l00198"></a><a class="code" href="classssobjects_1_1PacketBuffer.html#n5">00198</a>     <font class="keyword">friend</font> ClientConnector;                       
<a name="l00199"></a><a class="code" href="classssobjects_1_1PacketBuffer.html#n6">00199</a>     <font class="keyword">friend</font> BufferedSocket;                        
00200     <font class="keyword">virtual</font> <font class="keywordtype">void</font> <a class="code" href="classssobjects_1_1PacketBuffer.html#b0">receive</a>(BufferedSocket*);        
00201     <font class="keyword">virtual</font> <font class="keywordtype">void</font> <a class="code" href="classssobjects_1_1PacketBuffer.html#b1">transmit</a>(BufferedSocket*);       
<a name="l00202"></a><a class="code" href="classssobjects_1_1PacketBuffer.html#b2">00202</a>     <font class="keyword">virtual</font> <font class="keywordtype">void</font> <a class="code" href="classssobjects_1_1PacketBuffer.html#b2">process</a>()<font class="keyword"> </font>{}               
00203 
00204     <font class="comment">//overloadable methods</font>
00205   <font class="keyword">public</font>:
<a name="l00206"></a><a class="code" href="classssobjects_1_1PacketBuffer.html#a2">00206</a>     <font class="keyword">virtual</font> unsigned32  <a class="code" href="classssobjects_1_1PacketBuffer.html#a2">getPacketSize</a>()    <font class="keyword">const</font> {<font class="keywordflow">return</font> (unsigned32)(<a class="code" href="classssobjects_1_1PacketBuffer.html#d0">getHeaderSize</a>() + <a class="code" href="classssobjects_1_1PacketBuffer.html#a4">getBufferSize</a>());}  
<a name="l00207"></a><a class="code" href="classssobjects_1_1PacketBuffer.html#a3">00207</a>     <font class="keyword">virtual</font> unsigned32  <a class="code" href="classssobjects_1_1PacketBuffer.html#a3">getBufferSizeMax</a>()<font class="keyword"> const </font>{<font class="keywordflow">return</font> m_nBufferSizeMax;}                                 
<a name="l00208"></a><a class="code" href="classssobjects_1_1PacketBuffer.html#a4">00208</a>     <font class="keyword">virtual</font> unsigned32  <a class="code" href="classssobjects_1_1PacketBuffer.html#a4">getBufferSize</a>()    <font class="keyword">const</font> {<font class="keywordflow">return</font> m_packetHeader.getBufferSize();}                   
00209     <font class="keyword">virtual</font> unsigned8*  <a class="code" href="classssobjects_1_1PacketBuffer.html#a5">getBuffer</a>()        <font class="keyword">const</font>;                                                           
00210     <font class="keyword">virtual</font> unsigned8*  <a class="code" href="classssobjects_1_1PacketBuffer.html#a6">getPointer</a>()       <font class="keyword">const</font>;                                                           
<a name="l00211"></a><a class="code" href="classssobjects_1_1PacketBuffer.html#a7">00211</a>     <font class="keyword">virtual</font> unsigned8*  <a class="code" href="classssobjects_1_1PacketBuffer.html#a7">getHeader</a>()        <font class="keyword">const</font> {<font class="keywordflow">return</font> m_packetHeader.getHeader();}                       
00212     <font class="keyword">virtual</font> unsigned8*  <a class="code" href="classssobjects_1_1PacketBuffer.html#a8">resizeBuffer</a>(unsigned32 nNewSize);                                                  
00213 
00214   <font class="keyword">public</font>:
00215     <a class="code" href="classssobjects_1_1PacketBuffer.html#a12">PacketBuffer</a>(<font class="keyword">const</font> PacketBuffer&amp;);                                  
00216     PacketBuffer&amp; PacketBuffer::operator=(<font class="keyword">const</font> PacketBuffer&amp; packet);      
00217     <a class="code" href="classssobjects_1_1PacketBuffer.html#a12">PacketBuffer</a>(unsigned16 wCmd,unsigned32 nSize=DefaultPacketBufferSize); 
00218     <a class="code" href="classssobjects_1_1PacketBuffer.html#a12">PacketBuffer</a>();                                                         
00219     <font class="keyword">virtual</font> <a class="code" href="classssobjects_1_1PacketBuffer.html#a13">~PacketBuffer</a>();
00220 
00221     <font class="comment">//regular methods</font>
<a name="l00222"></a><a class="code" href="classssobjects_1_1PacketBuffer.html#a14">00222</a>     unsigned32  <a class="code" href="classssobjects_1_1PacketBuffer.html#a14">getID</a>()<font class="keyword">       </font>{<font class="keywordflow">return</font> m_nID;}                           
<a name="l00223"></a><a class="code" href="classssobjects_1_1PacketBuffer.html#a15">00223</a>     unsigned16  <a class="code" href="classssobjects_1_1PacketBuffer.html#a15">getCmd</a>()<font class="keyword"> const </font>{<font class="keywordflow">return</font> m_packetHeader.getCmd();}        
<a name="l00224"></a><a class="code" href="classssobjects_1_1PacketBuffer.html#a16">00224</a>     unsigned16  <a class="code" href="classssobjects_1_1PacketBuffer.html#a16">cookie</a>()<font class="keyword"> const </font>{<font class="keywordflow">return</font> m_packetHeader.getCookie();}     
<a name="l00225"></a><a class="code" href="classssobjects_1_1PacketBuffer.html#a17">00225</a>     <font class="keywordtype">void</font>        <a class="code" href="classssobjects_1_1PacketBuffer.html#a17">rewind</a>()<font class="keyword">      </font>{m_pPointer = m_Buffer;}                  
00226     <font class="keywordtype">void</font>        <a class="code" href="classssobjects_1_1PacketBuffer.html#a18">reset</a>();                                                
00227     <font class="keywordtype">void</font>        <a class="code" href="classssobjects_1_1PacketBuffer.html#a19">append</a>(unsigned8* pdata,unsigned32 nSize);              
00228 
00229   <font class="keyword">public</font>:
00230     <font class="comment">//overloads</font>
00231     <font class="keywordtype">void</font> <a class="code" href="classssobjects_1_1PacketBuffer.html#a20">operator &lt;&lt; </a>(<font class="keyword">const</font> <font class="keywordtype">char</font>*);   
00232     <font class="keywordtype">void</font> <a class="code" href="classssobjects_1_1PacketBuffer.html#a20">operator &lt;&lt; </a>(<font class="keywordtype">char</font>*);         
00233     <font class="keywordtype">void</font> <a class="code" href="classssobjects_1_1PacketBuffer.html#a20">operator &lt;&lt; </a>(CStr&amp;);     
00234     <font class="keywordtype">void</font> <a class="code" href="classssobjects_1_1PacketBuffer.html#a20">operator &lt;&lt; </a>(signed32);      
00235     <font class="keywordtype">void</font> <a class="code" href="classssobjects_1_1PacketBuffer.html#a20">operator &lt;&lt; </a>(unsigned32);    
00236     <font class="keywordtype">void</font> <a class="code" href="classssobjects_1_1PacketBuffer.html#a20">operator &lt;&lt; </a>(signed16);      
00237     <font class="keywordtype">void</font> <a class="code" href="classssobjects_1_1PacketBuffer.html#a20">operator &lt;&lt; </a>(unsigned16);    
00238     <font class="keywordtype">void</font> <a class="code" href="classssobjects_1_1PacketBuffer.html#a20">operator &lt;&lt; </a>(unsigned8);     
00239     <font class="keywordtype">void</font> <a class="code" href="classssobjects_1_1PacketBuffer.html#a20">operator &lt;&lt; </a>(<font class="keywordtype">double</font>);        
00240     <font class="keywordtype">void</font> <a class="code" href="classssobjects_1_1PacketBuffer.html#a20">operator &lt;&lt; </a>(<font class="keywordtype">float</font>);         
00241     
00242     <font class="keywordtype">void</font> <a class="code" href="classssobjects_1_1PacketBuffer.html#a30">operator &gt;&gt; </a>(<font class="keywordtype">char</font>*);         
00243     <font class="keywordtype">void</font> <a class="code" href="classssobjects_1_1PacketBuffer.html#a30">operator &gt;&gt; </a>(CStr&amp;);     
00244     <font class="keywordtype">void</font> <a class="code" href="classssobjects_1_1PacketBuffer.html#a30">operator &gt;&gt; </a>(signed32&amp;);     
00245     <font class="keywordtype">void</font> <a class="code" href="classssobjects_1_1PacketBuffer.html#a30">operator &gt;&gt; </a>(unsigned32&amp;);   
00246     <font class="keywordtype">void</font> <a class="code" href="classssobjects_1_1PacketBuffer.html#a30">operator &gt;&gt; </a>(signed16&amp;);     
00247     <font class="keywordtype">void</font> <a class="code" href="classssobjects_1_1PacketBuffer.html#a30">operator &gt;&gt; </a>(unsigned16&amp;);   
00248     <font class="keywordtype">void</font> <a class="code" href="classssobjects_1_1PacketBuffer.html#a30">operator &gt;&gt; </a>(unsigned8&amp;);    
00249     <font class="keywordtype">void</font> <a class="code" href="classssobjects_1_1PacketBuffer.html#a30">operator &gt;&gt; </a>(<font class="keywordtype">double</font>&amp;);       
00250     <font class="keywordtype">void</font> <a class="code" href="classssobjects_1_1PacketBuffer.html#a30">operator &gt;&gt; </a>(<font class="keywordtype">float</font>&amp;);        
00251 };
00252 
<a name="l00253"></a><a class="code" href="packetbuffer_8h.html#a4">00253</a> <font class="preprocessor">#define throwPacketBufferException(m) (throw PacketBufferException(m,__FILE__,__LINE__))</font>
00254 <font class="preprocessor"></font>
<a name="l00258"></a><a class="code" href="classssobjects_1_1PacketBufferException.html">00258</a> <font class="keyword">class </font>PacketBufferException : <font class="keyword">public</font> GeneralException
00259 {
00260   <font class="keyword">public</font>: <font class="comment">// Constructor/destructor</font>
<a name="l00261"></a><a class="code" href="classssobjects_1_1PacketBufferException.html#a0">00261</a>     <a class="code" href="classssobjects_1_1PacketBufferException.html#a0">PacketBufferException</a>(<font class="keywordtype">char</font>* pchMessage,<font class="keyword">const</font> <font class="keywordtype">char</font>* pFname,<font class="keyword">const</font> <font class="keywordtype">int</font> iLine) 
00262       : <a class="code" href="classssobjects_1_1GeneralException.html#a0">GeneralException</a>(pchMessage,pFname,iLine)<font class="keyword"></font>{};
00263 };
00264 
<a name="l00265"></a><a class="code" href="classssobjects_1_1NetFile.html">00265</a> <font class="keyword">class </font>NetFile : <font class="keyword">public</font> PacketBuffer
00266 {
00267   <font class="keyword">protected</font>:  <font class="comment">//attributes</font>
<a name="l00268"></a><a class="code" href="classssobjects_1_1NetFile.html#n0">00268</a>     unsigned32 m_nFileSize;
<a name="l00269"></a><a class="code" href="classssobjects_1_1NetFile.html#n1">00269</a>     CStr       m_strFilename;
<a name="l00270"></a><a class="code" href="classssobjects_1_1NetFile.html#n2">00270</a>     unsigned8* m_pFileData;
00271 
00272   <font class="keyword">protected</font>:  <font class="comment">//methods</font>
00273     <font class="keyword">virtual</font> <font class="keywordtype">void</font> <a class="code" href="classssobjects_1_1NetFile.html#b0">receive</a>(BufferedSocket* psocket);
00274     <font class="keyword">virtual</font> <font class="keywordtype">void</font> <a class="code" href="classssobjects_1_1NetFile.html#b1">transmit</a>(BufferedSocket* psocket);
00275 
00276   <font class="keyword">public</font>:     <font class="comment">//construction</font>
00277     <a class="code" href="classssobjects_1_1NetFile.html#a1">NetFile</a>(<font class="keyword">const</font> <font class="keywordtype">char</font>* pszFilename,unsigned32 nSize,unsigned8* pdata);
<a name="l00278"></a><a class="code" href="classssobjects_1_1NetFile.html#a1">00278</a>     <a class="code" href="classssobjects_1_1NetFile.html#a1">NetFile</a>() : m_nFileSize(0),m_strFilename(),m_pFileData(0){};
00279     <font class="keyword">virtual</font> <a class="code" href="classssobjects_1_1NetFile.html#a2">~NetFile</a>();
00280 
00281   <font class="keyword">public</font>:     <font class="comment">//user callable methods</font>
<a name="l00282"></a><a class="code" href="classssobjects_1_1NetFile.html#a3">00282</a>     CONSTCHAR*       <a class="code" href="classssobjects_1_1NetFile.html#a3">getFilename</a>()<font class="keyword">   </font>{<font class="keywordflow">return</font> m_strFilename;}
<a name="l00283"></a><a class="code" href="classssobjects_1_1NetFile.html#a4">00283</a>     <font class="keyword">const</font> unsigned32  <a class="code" href="classssobjects_1_1NetFile.html#a4">getSize</a>()<font class="keyword">      </font>{<font class="keywordflow">return</font> m_nFileSize;}
<a name="l00284"></a><a class="code" href="classssobjects_1_1NetFile.html#a5">00284</a>     unsigned8*        <a class="code" href="classssobjects_1_1NetFile.html#a5">getData</a>()<font class="keyword">      </font>{<font class="keywordflow">return</font> m_pFileData;}
00285 
00286   <font class="keyword">private</font>:
00287     <font class="comment">//unused overloads</font>
00288     <a class="code" href="classssobjects_1_1NetFile.html#a1">NetFile</a>(<font class="keyword">const</font> NetFile&amp;);
00289     NetFile&amp; <a class="code" href="classssobjects_1_1PacketBuffer.html#a10">operator=</a>(<font class="keyword">const</font> NetFile&amp;);
00290 };
00291 
<a name="l00292"></a><a class="code" href="packetbuffer_8h.html#a5">00292</a> <font class="preprocessor">#define throwNetFileException(m) (throw NetFileException(m,__FILE__,__LINE__))</font>
00293 <font class="preprocessor"></font>
<a name="l00294"></a><a class="code" href="classssobjects_1_1NetFileException.html">00294</a> <font class="keyword">class </font>NetFileException : <font class="keyword">public</font> PacketBufferException
00295 {
00296   <font class="keyword">public</font>: <font class="comment">// Constructor/destructor</font>
<a name="l00297"></a><a class="code" href="classssobjects_1_1NetFileException.html#a0">00297</a>     <a class="code" href="classssobjects_1_1NetFileException.html#a0">NetFileException</a>(<font class="keywordtype">char</font>* pchMessage,<font class="keyword">const</font> <font class="keywordtype">char</font>* pFname,<font class="keyword">const</font> <font class="keywordtype">int</font> iLine) 
00298       : <a class="code" href="classssobjects_1_1PacketBufferException.html#a0">PacketBufferException</a>(pchMessage,pFname,iLine)<font class="keyword"></font>{};
00299 };
00300 
00301 <font class="comment">//</font>
00302 <font class="comment">// all objects that will be sent over internet will be derived from </font>
00303 <font class="comment">// this class. You must override the two pure virtual methods to impliment</font>
00304 <font class="comment">// your new object. You don't override process(). Just the pure methods.</font>
00305 <font class="comment">//</font>
00306 <font class="comment">// All communicable objects can be ACKed or NAKed. </font>
00307 <font class="comment">//</font>
<a name="l00308"></a><a class="code" href="classssobjects_1_1Communicable.html">00308</a> <font class="keyword">class </font>Communicable : <font class="keyword">public</font> PacketBuffer
00309 {
00310   <font class="keyword">public</font>:
<a name="l00311"></a><a class="code" href="classssobjects_1_1Communicable.html#a0">00311</a>     <a class="code" href="classssobjects_1_1Communicable.html#a0">Communicable</a>()<font class="keyword"> </font>{}
<a name="l00312"></a><a class="code" href="classssobjects_1_1Communicable.html#a1">00312</a>     <a class="code" href="classssobjects_1_1Communicable.html#a0">Communicable</a>(unsigned16 wCmd) : PacketBuffer(wCmd) {}
00313 <font class="comment">//        Communicable(PacketBuffer* ppacket) {extract(ppacket);}   //example of how to call extract</font>
00314 
00315   <font class="keyword">protected</font>:
00316     <font class="comment">//extract data from packet, and fill your class data when receiving</font>
00317     <font class="comment">//you should override extraceData, and call extract when constructing with a packet pointer</font>
00318     <font class="comment">//</font>
<a name="l00319"></a><a class="code" href="classssobjects_1_1Communicable.html#b0">00319</a>     <font class="keyword">virtual</font> <font class="keywordtype">void</font> <a class="code" href="classssobjects_1_1Communicable.html#b0">extract</a>(PacketBuffer* ppacket)<font class="keyword"> </font>{<a class="code" href="classssobjects_1_1Communicable.html#b2">extractHeader</a>(ppacket); <a class="code" href="classssobjects_1_1Communicable.html#b1">extractData</a>(ppacket);}
00320     <font class="keyword">virtual</font> <font class="keywordtype">void</font> <a class="code" href="classssobjects_1_1Communicable.html#b1">extractData</a>(PacketBuffer*)=0;
<a name="l00321"></a><a class="code" href="classssobjects_1_1Communicable.html#b2">00321</a>     <font class="keyword">virtual</font> <font class="keywordtype">void</font> <a class="code" href="classssobjects_1_1Communicable.html#b2">extractHeader</a>(PacketBuffer* ppacket)<font class="keyword"> </font>
00322 <font class="keyword">    </font>{
00323       <font class="comment">//TODO: should use a copy constructor or something to copy entire header</font>
00324       <font class="comment">//TODO  in one shot instead of each member</font>
00325       m_packetHeader.m_nBufferSize = ppacket-&gt;m_packetHeader.m_nBufferSize;
00326       m_packetHeader.m_wCookie     = ppacket-&gt;m_packetHeader.m_wCookie;
00327       m_packetHeader.m_wCommand    = ppacket-&gt;m_packetHeader.m_wCommand;
00328     }
00329 
00330     <font class="comment">//take your class data, and put it into our packet buffer for sending</font>
00331     <font class="keyword">virtual</font> <font class="keywordtype">void</font> <a class="code" href="classssobjects_1_1Communicable.html#b3">stuff</a>()=0;
<a name="l00332"></a><a class="code" href="classssobjects_1_1Communicable.html#b4">00332</a>     <font class="keyword">virtual</font> <font class="keywordtype">void</font> <a class="code" href="classssobjects_1_1Communicable.html#b4">process</a>()<font class="keyword"> </font>{<a class="code" href="classssobjects_1_1Communicable.html#b0">extract</a>(<font class="keyword">this</font>);}      <font class="comment">//you don't override this</font>
00333 };
00334 
00335   };  <font class="comment">//namespace</font>
00336 
00337 <font class="preprocessor">#endif</font>
00338 <font class="preprocessor"></font>
</pre></div><hr><address><small>Generated at Tue Sep 25 00:26:36 2001 for SimpleServerObjects by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.7 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2001</small></address>
</body>
</html>
