<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>socketinstance.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.7 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>socketinstance.h</h1><a href="socketinstance_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/********************************************************************</font>
00002 <font class="comment">        Copyright (c) 2001, Lee Patterson &amp; Ant Works Software</font>
00003 <font class="comment">        http://ssobjects.sourceforge.net</font>
00004 <font class="comment"></font>
00005 <font class="comment">        Original source from Inside Visual C++</font>
00006 <font class="comment"></font>
00007 <font class="comment">        created  :  5/14/1998</font>
00008 <font class="comment">        filename :  socketinstance.h</font>
00009 <font class="comment">        author   :  Lee Patterson (lee@antws.com)</font>
00010 <font class="comment">        </font>
00011 <font class="comment">        purpose  :  Base socket class. Also http and telnet </font>
00012 <font class="comment">                    classes. Defaults to blocking mode.</font>
00013 <font class="comment"></font>
00014 <font class="comment">        notes    :  Typical client session would look like this:</font>
00015 <font class="comment">                    </font>
00016 <font class="comment">                    ...</font>
00017 <font class="comment">                    SocketInstance sConnection;</font>
00018 <font class="comment">                    try</font>
00019 <font class="comment">                    {</font>
00020 <font class="comment">                        //open connection</font>
00021 <font class="comment">                        puts("Connecting to server...");</font>
00022 <font class="comment">                        SockAddr saServer(szHost,iPort);</font>
00023 <font class="comment">                        if(isalpha(szHost[0]))  //check if szHost is in "host.com" format or "255.255.255.255"</font>
00024 <font class="comment">                            saServer = SocketInstance::getHostByName(szHost,iPort);</font>
00025 <font class="comment">                        sConnection.create();</font>
00026 <font class="comment">                        sConnection.connect(saServer);</font>
00027 <font class="comment">                        //we are connected, so some transfering</font>
00028 <font class="comment">                        ...</font>
00029 <font class="comment">                        sConnection.close();</font>
00030 <font class="comment">                    }</font>
00031 <font class="comment">                    catch(GeneralException* e)</font>
00032 <font class="comment">                    {</font>
00033 <font class="comment">                        sConnection.cleanup();</font>
00034 <font class="comment">                        LOG("error %s",e-&gt;getErrorMsg());</font>
00035 <font class="comment">                    }</font>
00036 <font class="comment">                    ...</font>
00037 <font class="comment">                    </font>
00038 <font class="comment">                    A server would look like this:</font>
00039 <font class="comment">                    </font>
00040 <font class="comment">                    ...</font>
00041 <font class="comment">                    SocketInstance sClient;</font>
00042 <font class="comment">                    SockAddr saClient;</font>
00043 <font class="comment">                    SockAddr saServer(INADDR_ANY,atoi(argv[1]));</font>
00044 <font class="comment">                    SocketInstance sListen;</font>
00045 <font class="comment">                    try</font>
00046 <font class="comment">                    {</font>
00047 <font class="comment">                        sListen.create();</font>
00048 <font class="comment">                        sListen.bind(saServer);</font>
00049 <font class="comment">                        sListen.listen();</font>
00050 <font class="comment">                        while(bWantMoreConnections)</font>
00051 <font class="comment">                        {</font>
00052 <font class="comment">                            sListen.accept(sClient,saClient);</font>
00053 <font class="comment">                            //we got a connection ...</font>
00054 <font class="comment">                            sClient.close();</font>
00055 <font class="comment">                        }</font>
00056 <font class="comment">                        sListen.close();</font>
00057 <font class="comment">                    }</font>
00058 <font class="comment">                    catch(GeneralException* e)</font>
00059 <font class="comment">                    {</font>
00060 <font class="comment">                        sConnection.cleanup();</font>
00061 <font class="comment">                        LOG("error %s",e-&gt;getErrorMsg());</font>
00062 <font class="comment">                    }</font>
00063 <font class="comment">                    ...</font>
00064 <font class="comment">                    </font>
00065 <font class="comment">                    </font>
00066 <font class="comment"></font>
00067 <font class="comment">*********************************************************************/</font>
00068 
00069 <font class="preprocessor">#ifndef SOCKETINSTANCE_H</font>
00070 <font class="preprocessor"></font><font class="preprocessor">#define SOCKETINSTANCE_H</font>
00071 <font class="preprocessor"></font>
00072 <font class="preprocessor">#ifdef OS_LINUX</font>
00073 <font class="preprocessor"></font><font class="preprocessor">#define USE_POLL</font>
00074 <font class="preprocessor"></font><font class="preprocessor">#endif</font>
00075 <font class="preprocessor"></font>
<a name="l00076"></a><a class="code" href="socketinstance_8h.html#a0">00076</a> <font class="preprocessor">#define __SockAddr__</font>
<a name="l00077"></a><a class="code" href="socketinstance_8h.html#a1">00077</a> <font class="preprocessor"></font><font class="preprocessor">#define __SocketInstance__</font>
<a name="l00078"></a><a class="code" href="socketinstance_8h.html#a2">00078</a> <font class="preprocessor"></font><font class="preprocessor">#define __SocketInstanceException__</font>
<a name="l00079"></a><a class="code" href="socketinstance_8h.html#a3">00079</a> <font class="preprocessor"></font><font class="preprocessor">#define __TelnetSocket__</font>
<a name="l00080"></a><a class="code" href="socketinstance_8h.html#a4">00080</a> <font class="preprocessor"></font><font class="preprocessor">#define __HttpBlockingSocket__</font>
00081 <font class="preprocessor"></font>
00082 <font class="preprocessor">#ifdef WIN32</font>
00083 <font class="preprocessor"></font><font class="preprocessor">#include &lt;winsock.h&gt;</font>
00084 <font class="preprocessor">#endif</font>
00085 <font class="preprocessor"></font>
00086 <font class="preprocessor">#include &lt;sys/types.h&gt;</font>
00087 <font class="preprocessor">#include &lt;ctype.h&gt;</font>
00088 <font class="preprocessor">#include "<a class="code" href="msdefs_8h.html">msdefs.h</a>"</font>
00089 <font class="preprocessor">#include &lt;stdio.h&gt;</font>
00090 
00091 <font class="preprocessor">#ifndef WIN32</font>
00092 <font class="preprocessor"></font><font class="preprocessor"># include &lt;netinet/in.h&gt;</font>
00093 <font class="preprocessor"># include &lt;netdb.h&gt;</font>
00094 <font class="preprocessor"># ifndef USE_POLL</font>
00095 <font class="preprocessor"></font><font class="preprocessor">#   include &lt;sys/select.h&gt;</font>    <font class="comment">//not using select, using poll instead as select gave me some headaches</font>
00096 <font class="preprocessor"># else</font>
00097 <font class="preprocessor"></font><font class="preprocessor">#   include &lt;sys/poll.h&gt;</font>
00098 <font class="preprocessor"># endif</font>
00099 <font class="preprocessor"></font><font class="preprocessor"># include &lt;arpa/inet.h&gt;</font>
00100 <font class="preprocessor"># include &lt;sys/time.h&gt;</font>
00101 <font class="preprocessor"># include &lt;sys/types.h&gt;</font>
00102 <font class="preprocessor"># include &lt;sys/socket.h&gt;</font>
00103 <font class="preprocessor"># include &lt;unistd.h&gt;</font>
00104 <font class="preprocessor">#endif</font>
00105 <font class="preprocessor"></font>
00106 <font class="preprocessor">#include &lt;stdio.h&gt;</font>
00107 <font class="preprocessor">#include &lt;stdlib.h&gt;</font>
00108 <font class="preprocessor">#include "<a class="code" href="generalexception_8h.html">generalexception.h</a>"</font>
00109 <font class="preprocessor">#include "errno.h"</font>
00110 
00111 <font class="keyword">enum</font> {
00112     DEFAULT_SOCKET_TIMEOUT=600,     <font class="comment">//10 minutes</font>
00113     NO_TIMEOUT=0,                   <font class="comment">//never time out    </font>
00114 };
00115 
<a name="l00116"></a><a class="code" href="socketinstance_8h.html#a5">00116</a> <font class="preprocessor">#define TELNET_PORT         23</font>
<a name="l00117"></a><a class="code" href="socketinstance_8h.html#a6">00117</a> <font class="preprocessor"></font><font class="preprocessor">#define WEB_PORT            80</font>
00118 <font class="preprocessor"></font>
00119 <font class="preprocessor">#ifndef WIN32</font>
<a name="l00120"></a><a class="code" href="socketinstance_8h.html#a7">00120</a> <font class="preprocessor"></font><font class="preprocessor"># define WSAEWOULDBLOCK       EWOULDBLOCK</font>
<a name="l00121"></a><a class="code" href="socketinstance_8h.html#a8">00121</a> <font class="preprocessor"></font><font class="preprocessor"># define SOCKET_ERROR        (-1)</font>
<a name="l00122"></a><a class="code" href="socketinstance_8h.html#a9">00122</a> <font class="preprocessor"></font><font class="preprocessor"># define INVALID_SOCKET      (-1)</font>
<a name="l00123"></a><a class="code" href="socketinstance_8h.html#a10">00123</a> <font class="preprocessor"></font><font class="preprocessor"># define closesocket(s)      close(s)</font>
<a name="l00124"></a><a class="code" href="socketinstance_8h.html#a11">00124</a> <font class="preprocessor"></font><font class="preprocessor"># define WSAGetLastError()   errno</font>
00125 <font class="preprocessor"></font>
<a name="l00126"></a><a class="code" href="socketinstance_8h.html#a13">00126</a> <font class="keyword">typedef</font> <font class="keywordtype">int</font> SOCKET;
<a name="l00127"></a><a class="code" href="socketinstance_8h.html#a14">00127</a> <font class="keyword">typedef</font> <font class="keyword">struct </font>sockaddr        SOCKADDR;
00128 
<a name="l00129"></a><a class="code" href="socketinstance_8h.html#a15">00129</a> <font class="keyword">typedef</font> <font class="keyword">struct </font><a class="code" href="classsockaddr__in.html">sockaddr_in</a>     <a class="code" href="classsockaddr__in.html">SOCKADDR_IN</a>;
<a name="l00130"></a><a class="code" href="socketinstance_8h.html#a16">00130</a> <font class="keyword">typedef</font> <font class="keyword">struct </font><a class="code" href="classsockaddr__in.html">sockaddr_in</a>*    <a class="code" href="classsockaddr__in.html">LPSOCKADDR_IN</a>;
00131 <font class="preprocessor">#endif</font>
00132 <font class="preprocessor"></font>
00133 <font class="preprocessor">#ifdef WIN32</font>
00134 <font class="preprocessor"></font>  <font class="keyword">typedef</font> <font class="keywordtype">int</font> socklen_t;
00135 <font class="preprocessor">#endif</font>
00136 <font class="preprocessor"></font>
<a name="l00137"></a><a class="code" href="socketinstance_8h.html#a17">00137</a> <font class="keyword">typedef</font> <font class="keyword">struct </font><a class="code" href="classtimeval.html">timeval</a>  <a class="code" href="classtimeval.html">TIMEVAL</a>;
<a name="l00138"></a><a class="code" href="socketinstance_8h.html#a18">00138</a> <font class="keyword">typedef</font> <font class="keywordtype">unsigned</font> <font class="keywordtype">long</font>   ULONG;
<a name="l00139"></a><a class="code" href="socketinstance_8h.html#a19">00139</a> <font class="keyword">typedef</font> <font class="keywordtype">unsigned</font> <font class="keywordtype">short</font>  USHORT;
00140 
<a name="l00141"></a><a class="code" href="socketinstance_8h.html#a20">00141</a> <font class="keyword">typedef</font> <font class="keyword">const</font> <font class="keyword">struct </font>sockaddr* LPCSOCKADDR;
<a name="l00142"></a><a class="code" href="socketinstance_8h.html#a21">00142</a> <font class="keyword">typedef</font> <font class="keyword">struct </font>sockaddr*       LPSOCKADDR;
00143 
00144 <font class="keyword">namespace </font>ssobjects
00145 {
00146 
00147 
00148 
00149 <font class="comment">// member functions truly block and must not be used in UI threads</font>
00150 <font class="comment">// use this class as an alternative to the MFC CSocket class</font>
00151 
00152 <font class="preprocessor">#ifdef __SocketInstanceException__</font>
<a name="l00153"></a><a class="code" href="socketinstance_8h.html#a12">00153</a> <font class="preprocessor"></font><font class="preprocessor">#define throwSocketInstanceException(m) (throw SocketInstanceException(m,__FILE__,__LINE__))</font>
00154 <font class="preprocessor"></font>
<a name="l00161"></a><a class="code" href="classssobjects_1_1SocketInstanceException.html">00161</a> <font class="keyword">class </font>SocketInstanceException : <font class="keyword">public</font> GeneralException
00162 {
00163 <font class="keyword">public</font>:
<a name="l00164"></a><a class="code" href="classssobjects_1_1SocketInstanceException.html#a0">00164</a>     <a class="code" href="classssobjects_1_1SocketInstanceException.html#a0">SocketInstanceException</a>(<font class="keyword">const</font> <font class="keywordtype">char</font>* pchMessage,<font class="keyword">const</font> <font class="keywordtype">char</font>* pFname,<font class="keyword">const</font> <font class="keywordtype">int</font> iLine) : GeneralException(pchMessage,pFname,iLine){}
<a name="l00165"></a><a class="code" href="classssobjects_1_1SocketInstanceException.html#a1">00165</a>     <a class="code" href="classssobjects_1_1SocketInstanceException.html#a1">~SocketInstanceException</a>()<font class="keyword"></font>{}
00166 };
00167 <font class="preprocessor">#endif</font>
00168 <font class="preprocessor"></font>
00169 <font class="preprocessor">#ifdef __SocketInstance__</font>
00170 <font class="preprocessor"></font><font class="keyword">class </font>SockAddr;
00171 
<a name="l00234"></a><a class="code" href="classssobjects_1_1SocketInstance.html">00234</a> <font class="keyword">class </font>SocketInstance 
00235 {
00236   <font class="keyword">public</font>:
<a name="l00237"></a><a class="code" href="classssobjects_1_1SocketInstance.html#m0">00237</a>     SOCKET m_hSocket;
<a name="l00238"></a><a class="code" href="classssobjects_1_1SocketInstance.html#m1">00238</a>     <font class="keywordtype">bool</font>   m_bThrowExceptionOnReadClose;
<a name="l00239"></a><a class="code" href="classssobjects_1_1SocketInstance.html#a0">00239</a>     <a class="code" href="classssobjects_1_1SocketInstance.html#a0">SocketInstance</a>() : m_hSocket(0),m_bThrowExceptionOnReadClose(true) {}
<a name="l00240"></a><a class="code" href="classssobjects_1_1SocketInstance.html#a1">00240</a>     SOCKET <a class="code" href="classssobjects_1_1SocketInstance.html#a1">getSocket</a>()<font class="keyword"> const </font>{<font class="keywordflow">return</font> m_hSocket;}
00241     <font class="keywordtype">void</font> <a class="code" href="classssobjects_1_1SocketInstance.html#a2">setExceptionOnReadClose</a>(<font class="keyword">const</font> <font class="keywordtype">bool</font> bThrowException=<font class="keyword">true</font>);  
00242     <font class="keywordtype">void</font> <a class="code" href="classssobjects_1_1SocketInstance.html#a3">cleanup</a>();
00243     <font class="keywordtype">void</font> <a class="code" href="classssobjects_1_1SocketInstance.html#a4">create</a>(<font class="keyword">const</font> <font class="keywordtype">int</font> nType = SOCK_STREAM);
00244     <font class="keywordtype">void</font> <a class="code" href="classssobjects_1_1SocketInstance.html#a5">close</a>();
00245     <font class="keywordtype">void</font> <a class="code" href="classssobjects_1_1SocketInstance.html#a6">bind</a>(LPCSOCKADDR psa);
00246     <font class="keywordtype">void</font> <a class="code" href="classssobjects_1_1SocketInstance.html#a7">listen</a>();
00247     <font class="keywordtype">void</font> <a class="code" href="classssobjects_1_1SocketInstance.html#a8">connect</a>(LPCSOCKADDR psa);
00248     <font class="keywordtype">bool</font> <a class="code" href="classssobjects_1_1SocketInstance.html#a9">accept</a>(SocketInstance&amp; s, LPSOCKADDR psa);
00249     <font class="keywordtype">bool</font> <a class="code" href="classssobjects_1_1SocketInstance.html#a9">accept</a>(SocketInstance* s, LPSOCKADDR psa);
00250     <font class="keywordtype">int</font> <a class="code" href="classssobjects_1_1SocketInstance.html#a11">send</a>(<font class="keyword">const</font> <font class="keywordtype">char</font>* pch, <font class="keyword">const</font> <font class="keywordtype">int</font> nSize, <font class="keyword">const</font> <font class="keywordtype">int</font> nSecs=DEFAULT_SOCKET_TIMEOUT);
00251     <font class="keywordtype">int</font> <a class="code" href="classssobjects_1_1SocketInstance.html#a12">write</a>(<font class="keyword">const</font> <font class="keywordtype">char</font>* pch, <font class="keyword">const</font> <font class="keywordtype">int</font> nSize, <font class="keyword">const</font> <font class="keywordtype">int</font> nSecs=DEFAULT_SOCKET_TIMEOUT);
00252     <font class="keywordtype">int</font> <a class="code" href="classssobjects_1_1SocketInstance.html#a13">recv</a>(<font class="keywordtype">char</font>* pch, <font class="keyword">const</font> <font class="keywordtype">int</font> nSize, <font class="keyword">const</font> <font class="keywordtype">int</font> nSecs=DEFAULT_SOCKET_TIMEOUT);
00253     <font class="keywordtype">int</font> <a class="code" href="classssobjects_1_1SocketInstance.html#a14">sendDatagram</a>(<font class="keyword">const</font> <font class="keywordtype">char</font>* pch, <font class="keyword">const</font> <font class="keywordtype">int</font> nSize, LPCSOCKADDR psa, 
00254                      <font class="keyword">const</font> <font class="keywordtype">int</font> nSecs=10);
00255     <font class="keywordtype">int</font> <a class="code" href="classssobjects_1_1SocketInstance.html#a15">receiveDatagram</a>(<font class="keywordtype">char</font>* pch, <font class="keyword">const</font> <font class="keywordtype">int</font> nSize, LPSOCKADDR psa, 
00256                         <font class="keyword">const</font> <font class="keywordtype">int</font> nSecs=10);
00257     <font class="keywordtype">void</font> <a class="code" href="classssobjects_1_1SocketInstance.html#a16">getPeerAddr</a>(LPSOCKADDR psa);
00258     <font class="keywordtype">void</font> <a class="code" href="classssobjects_1_1SocketInstance.html#a17">getSockAddr</a>(LPSOCKADDR psa);
00259     <font class="keyword">static</font> SockAddr <a class="code" href="classssobjects_1_1SocketInstance.html#d0">getHostByName</a>(<font class="keyword">const</font> <font class="keywordtype">char</font>* pchName, 
00260                                     <font class="keyword">const</font> USHORT ushPort = 0);
00261     <font class="keyword">static</font> <font class="keyword">const</font> <font class="keywordtype">char</font>* <a class="code" href="classssobjects_1_1SocketInstance.html#d1">getHostByAddr</a>(LPCSOCKADDR psa);
<a name="l00262"></a><a class="code" href="classssobjects_1_1SocketInstance.html#a18">00262</a>     <a class="code" href="classssobjects_1_1SocketInstance.html#a18">operator SOCKET</a>()<font class="keyword"></font>
00263 <font class="keyword">    </font>{ <font class="keywordflow">return</font> m_hSocket; }
00264     
00265     SocketInstance&amp; <a class="code" href="classssobjects_1_1SocketInstance.html#a19">operator=</a>(<font class="keyword">const</font> SocketInstance&amp; s);
<a name="l00266"></a><a class="code" href="classssobjects_1_1SocketInstance.html#a20">00266</a>     <a class="code" href="classssobjects_1_1SocketInstance.html#a0">SocketInstance</a>(<font class="keyword">const</font> SocketInstance&amp; s) : m_hSocket(s.m_hSocket),m_bThrowExceptionOnReadClose(s.m_bThrowExceptionOnReadClose) {}
00267 };
00268 <font class="preprocessor">#endif</font>
00269 <font class="preprocessor"></font>
00270 <font class="preprocessor">#ifdef __SockAddr__</font>
00271 <font class="preprocessor"></font>
<a name="l00277"></a><a class="code" href="classssobjects_1_1SockAddr.html">00277</a> <font class="keyword">class </font>SockAddr : <font class="keyword">public</font> <a class="code" href="classsockaddr__in.html">sockaddr_in</a> 
00278 {
00279   <font class="keyword">public</font>:
00280     <font class="comment">// constructors</font>
<a name="l00281"></a><a class="code" href="classssobjects_1_1SockAddr.html#a0">00281</a>     <a class="code" href="classssobjects_1_1SockAddr.html#a0">SockAddr</a>()<font class="keyword"></font>
00282 <font class="keyword">    </font>{ sin_family = AF_INET;
00283     sin_port = 0;
00284     sin_addr.s_addr = 0; } <font class="comment">// Default</font>
<a name="l00285"></a><a class="code" href="classssobjects_1_1SockAddr.html#a1">00285</a>     <a class="code" href="classssobjects_1_1SockAddr.html#a0">SockAddr</a>(<font class="keyword">const</font> sockaddr&amp; sa)<font class="keyword"> </font>{ memcpy(<font class="keyword">this</font>, &amp;sa, <font class="keyword">sizeof</font>(SOCKADDR)); }
<a name="l00286"></a><a class="code" href="classssobjects_1_1SockAddr.html#a2">00286</a>     <a class="code" href="classssobjects_1_1SockAddr.html#a0">SockAddr</a>(<font class="keyword">const</font> <a class="code" href="classsockaddr__in.html">sockaddr_in</a>&amp; sin)<font class="keyword"> </font>{ memcpy(<font class="keyword">this</font>, &amp;sin, <font class="keyword">sizeof</font>(<a class="code" href="classsockaddr__in.html">SOCKADDR_IN</a>)); }
<a name="l00287"></a><a class="code" href="classssobjects_1_1SockAddr.html#a3">00287</a>     <a class="code" href="classssobjects_1_1SockAddr.html#a0">SockAddr</a>(<font class="keyword">const</font> ULONG ulAddr, <font class="keyword">const</font> USHORT ushPort = 0) <font class="comment">// parms are host byte ordered</font>
00288     { sin_family = AF_INET;
00289     sin_port = htons(ushPort);
00290     sin_addr.s_addr = htonl(ulAddr); }
00291 <font class="preprocessor">#ifdef OS_LINUX</font>
00292 <font class="preprocessor"></font>    <a class="code" href="classssobjects_1_1SockAddr.html#a0">SockAddr</a>(<font class="keyword">const</font> uint32_t ulAddr, <font class="keyword">const</font> USHORT ushPort = 0) <font class="comment">// parms are host byte ordered</font>
00293     { sin_family = AF_INET;
00294     sin_port = htons(ushPort);
00295     sin_addr.s_addr = htonl(ulAddr); }
00296 <font class="preprocessor">#endif</font>
<a name="l00297"></a><a class="code" href="classssobjects_1_1SockAddr.html#a4">00297</a> <font class="preprocessor"></font>    <a class="code" href="classssobjects_1_1SockAddr.html#a0">SockAddr</a>(<font class="keyword">const</font> <font class="keywordtype">char</font>* pchIP, <font class="keyword">const</font> USHORT ushPort = 0) <font class="comment">// dotted IP addr string</font>
00298     { 
00299       <font class="keywordflow">if</font>(isalpha(pchIP[0])) <font class="comment">//check if IP is in "host.com" format or "255.255.255.255"</font>
00300       {
00301         <font class="keyword">struct </font>hostent* pHostEnt = gethostbyname(pchIP);
00302         <font class="keywordflow">if</font>(pHostEnt == NULL) {
00303           CStr s;
00304           <font class="keywordtype">int</font> err = <a class="code" href="socketinstance_8h.html#a11">WSAGetLastError</a>();
00305           strerror(err);
00306           s.format(<font class="stringliteral">"SockAddr GetHostByName error %d:%s"</font>,err,strerror(err));
00307       
00308           <a class="code" href="socketinstance_8h.html#a12">throwSocketInstanceException</a>((<font class="keyword">const</font> <font class="keywordtype">char</font>*)s);
00309         }
00310         ULONG* pulAddr = (ULONG*) pHostEnt-&gt;h_addr_list[0];
00311         sin_family = AF_INET;
00312         sin_port = htons(ushPort);
00313         sin_addr.s_addr = *pulAddr; <font class="comment">// address is already in network byte order</font>
00314                 
00315       }
00316       <font class="keywordflow">else</font>
00317       {
00318         sin_family = AF_INET;
00319         sin_port = htons(ushPort);
00320         sin_addr.s_addr = inet_addr(pchIP); 
00321       }
00322     } <font class="comment">// already network byte ordered</font>
00323     <font class="comment">// Return the address in dotted-decimal format</font>
<a name="l00324"></a><a class="code" href="classssobjects_1_1SockAddr.html#a5">00324</a>     <font class="keywordtype">char</font>* <a class="code" href="classssobjects_1_1SockAddr.html#a5">dottedDecimal</a>()<font class="keyword"></font>
00325 <font class="keyword">    </font>{ <font class="keywordflow">return</font> inet_ntoa(sin_addr); }
00326     <font class="comment">// Get port and address (even though they're public)</font>
<a name="l00327"></a><a class="code" href="classssobjects_1_1SockAddr.html#a6">00327</a>     USHORT <a class="code" href="classssobjects_1_1SockAddr.html#a6">port</a>()<font class="keyword"> const</font>
00328 <font class="keyword">    </font>{ <font class="keywordflow">return</font> ntohs(sin_port); }
<a name="l00329"></a><a class="code" href="classssobjects_1_1SockAddr.html#a7">00329</a>     ULONG <a class="code" href="classssobjects_1_1SockAddr.html#a7">ipAddr</a>()<font class="keyword"> const</font>
00330 <font class="keyword">    </font>{ <font class="keywordflow">return</font> ntohl(sin_addr.s_addr); }
00331     <font class="comment">// operators added for efficiency</font>
<a name="l00332"></a><a class="code" href="classssobjects_1_1SockAddr.html#a8">00332</a>     <font class="keyword">const</font> SockAddr&amp; <a class="code" href="classssobjects_1_1SockAddr.html#a8">operator=</a>(<font class="keyword">const</font> SOCKADDR&amp; sa)<font class="keyword"></font>
00333 <font class="keyword">    </font>{ memcpy(<font class="keyword">this</font>, &amp;sa, <font class="keyword">sizeof</font>(SOCKADDR));
00334     <font class="keywordflow">return</font> *<font class="keyword">this</font>; }
<a name="l00335"></a><a class="code" href="classssobjects_1_1SockAddr.html#a9">00335</a>     <font class="keyword">const</font> SockAddr&amp; <a class="code" href="classssobjects_1_1SockAddr.html#a8">operator=</a>(<font class="keyword">const</font> <a class="code" href="classsockaddr__in.html">SOCKADDR_IN</a>&amp; sin)<font class="keyword"></font>
00336 <font class="keyword">    </font>{ memcpy(<font class="keyword">this</font>, &amp;sin, <font class="keyword">sizeof</font>(<a class="code" href="classsockaddr__in.html">SOCKADDR_IN</a>));
00337     <font class="keywordflow">return</font> *<font class="keyword">this</font>; }
<a name="l00338"></a><a class="code" href="classssobjects_1_1SockAddr.html#a10">00338</a>     <a class="code" href="classssobjects_1_1SockAddr.html#a10">operator SOCKADDR</a>()<font class="keyword"></font>
00339 <font class="keyword">    </font>{ <font class="keywordflow">return</font> *((LPSOCKADDR) <font class="keyword">this</font>); }
<a name="l00340"></a><a class="code" href="classssobjects_1_1SockAddr.html#a11">00340</a>     <a class="code" href="classssobjects_1_1SockAddr.html#a11">operator LPSOCKADDR</a>()<font class="keyword"></font>
00341 <font class="keyword">    </font>{ <font class="keywordflow">return</font> (LPSOCKADDR) <font class="keyword">this</font>; }
<a name="l00342"></a><a class="code" href="classssobjects_1_1SockAddr.html#a12">00342</a>     <a class="code" href="classssobjects_1_1SockAddr.html#a12">operator LPSOCKADDR_IN</a>()<font class="keyword"></font>
00343 <font class="keyword">    </font>{ <font class="keywordflow">return</font> (<a class="code" href="classsockaddr__in.html">LPSOCKADDR_IN</a>) <font class="keyword">this</font>; }
00344     <font class="keywordtype">bool</font> <a class="code" href="classssobjects_1_1SockAddr.html#a13">operator == </a>(<font class="keyword">const</font> <a class="code" href="classsockaddr__in.html">sockaddr_in</a>&amp; sa);     
00345 };
00346 <font class="preprocessor">#endif</font>
00347 <font class="preprocessor"></font>
00348 
00349 <font class="preprocessor">#ifdef __TelnetSocket__</font>
<a name="l00350"></a><a class="code" href="classssobjects_1_1TelnetSocket.html">00350</a> <font class="preprocessor"></font><font class="keyword">class </font>TelnetSocket : <font class="keyword">public</font> SocketInstance
00351 {
00352   <font class="keyword">public</font>:
00353     <font class="keyword">enum</font> {nSizeRecv = 1024}; <font class="comment">// max receive buffer size (&gt; hdr line length)</font>
00354     <font class="keyword">enum</font> {FLAG_VALIDATED=1,FLAG_PLAYING=2};
00355     <a class="code" href="classssobjects_1_1TelnetSocket.html#a0">TelnetSocket</a>();
00356     <a class="code" href="classssobjects_1_1TelnetSocket.html#a0">TelnetSocket</a>(SocketInstance&amp; s);
00357     <a class="code" href="classssobjects_1_1TelnetSocket.html#a0">TelnetSocket</a>(SocketInstance* s);
00358     <font class="keyword">virtual</font> <a class="code" href="classssobjects_1_1TelnetSocket.html#a3">~TelnetSocket</a>();
00359     <font class="keywordtype">int</font> <a class="code" href="classssobjects_1_1TelnetSocket.html#a4">readLine</a>(<font class="keywordtype">char</font>* pch, <font class="keyword">const</font> <font class="keywordtype">int</font> nSize, <font class="keyword">const</font> <font class="keywordtype">int</font> nSecs=DEFAULT_SOCKET_TIMEOUT);
00360     <font class="keywordtype">int</font> <a class="code" href="classssobjects_1_1TelnetSocket.html#a5">readResponse</a>(<font class="keywordtype">char</font>* pch, <font class="keyword">const</font> <font class="keywordtype">int</font> nSize, <font class="keyword">const</font> <font class="keywordtype">int</font> nSecs=DEFAULT_SOCKET_TIMEOUT);
00361     <font class="keywordtype">int</font> <a class="code" href="classssobjects_1_1TelnetSocket.html#a6">println</a>(<font class="keyword">const</font> <font class="keywordtype">char</font>* fmt,...);
00362     <font class="keywordtype">int</font> <a class="code" href="classssobjects_1_1TelnetSocket.html#a7">print</a>(<font class="keyword">const</font> <font class="keywordtype">char</font>* fmt,...);
00363     <font class="keywordtype">bool</font> <a class="code" href="classssobjects_1_1TelnetSocket.html#a8">setLoginName</a>(<font class="keyword">const</font> <font class="keywordtype">char</font>* name);
00364 
00365   <font class="keyword">public</font>:
00366     <font class="comment">//login information</font>
<a name="l00367"></a><a class="code" href="classssobjects_1_1TelnetSocket.html#m0">00367</a>     <font class="keywordtype">char</font>* m_pLoginName;
<a name="l00368"></a><a class="code" href="classssobjects_1_1TelnetSocket.html#m1">00368</a>     WORD m_wFlags;
00369 
00370   <font class="keyword">private</font>:
00371     <font class="keywordtype">char</font>* m_pReadBuf; <font class="comment">// read buffer</font>
00372     <font class="keywordtype">int</font> m_nReadBuf; <font class="comment">// number of bytes in the read buffer</font>
00373 
00374   <font class="keyword">private</font>:
00375     <a class="code" href="classssobjects_1_1TelnetSocket.html#a0">TelnetSocket</a>(<font class="keyword">const</font> TelnetSocket&amp;);
00376     TelnetSocket&amp; <a class="code" href="classssobjects_1_1SocketInstance.html#a19">operator=</a>(<font class="keyword">const</font> TelnetSocket&amp;);
00377 };
00378 <font class="preprocessor">#endif</font>
00379 <font class="preprocessor"></font>
00380 <font class="preprocessor">#ifdef __HttpBlockingSocket__</font>
<a name="l00381"></a><a class="code" href="classssobjects_1_1HttpBlockingSocket.html">00381</a> <font class="preprocessor"></font><font class="keyword">class </font>HttpBlockingSocket : <font class="keyword">public</font> SocketInstance
00382 {
00383   <font class="keyword">public</font>:
00384     <font class="keyword">enum</font> {nSizeRecv = 1000}; <font class="comment">// max receive buffer size (&gt; hdr line length)</font>
00385     <a class="code" href="classssobjects_1_1HttpBlockingSocket.html#a0">HttpBlockingSocket</a>();
00386     <a class="code" href="classssobjects_1_1HttpBlockingSocket.html#a1">~HttpBlockingSocket</a>();
00387     <font class="keywordtype">int</font> <a class="code" href="classssobjects_1_1HttpBlockingSocket.html#a2">readHttpHeaderLine</a>(<font class="keywordtype">char</font>* pch, <font class="keyword">const</font> <font class="keywordtype">int</font> nSize, <font class="keyword">const</font> <font class="keywordtype">int</font> nSecs);
00388     <font class="keywordtype">int</font> <a class="code" href="classssobjects_1_1HttpBlockingSocket.html#a3">readHttpResponse</a>(<font class="keywordtype">char</font>* pch, <font class="keyword">const</font> <font class="keywordtype">int</font> nSize, <font class="keyword">const</font> <font class="keywordtype">int</font> nSecs);
00389   <font class="keyword">private</font>:
00390     <font class="keywordtype">char</font>* m_pReadBuf; <font class="comment">// read buffer</font>
00391     <font class="keywordtype">int</font> m_nReadBuf; <font class="comment">// number of bytes in the read buffer</font>
00392   <font class="keyword">private</font>:
00393     <font class="comment">//unused overloads</font>
00394     <a class="code" href="classssobjects_1_1HttpBlockingSocket.html#a0">HttpBlockingSocket</a>(<font class="keyword">const</font> HttpBlockingSocket&amp;);
00395     HttpBlockingSocket&amp; <a class="code" href="classssobjects_1_1SocketInstance.html#a19">operator=</a>(<font class="keyword">const</font> HttpBlockingSocket&amp;);
00396 };
00397 <font class="preprocessor">#endif</font>
00398 <font class="preprocessor"></font>
00399 };
00400 
00401 <font class="preprocessor">#endif</font>
00402 <font class="preprocessor"></font>
</pre></div><hr><address><small>Generated at Tue Sep 25 00:26:36 2001 for SimpleServerObjects by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.7 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2001</small></address>
</body>
</html>
