<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>simpleserver.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.7 -->
<center>
<a class="qindex" href="main.html">Main Page</a> &nbsp; <a class="qindex" href="namespaces.html">Namespace List</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="namespacemembers.html">Namespace Members</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><h1>simpleserver.h</h1><a href="simpleserver_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <font class="comment">/********************************************************************</font>
00002 <font class="comment">       Copyright (c) 2001, Lee Patterson &amp; Ant Works Software</font>
00003 <font class="comment">       http://ssobjects.sourceforge.net</font>
00004 <font class="comment"></font>
00005 <font class="comment">       created  :  December &lt;19, 2000</font>
00006 <font class="comment">       filename :  simpleserver.h</font>
00007 <font class="comment">       author   :  Lee Patterson (lee@antws.com)</font>
00008 <font class="comment">       purpose  :  Simple server is a class that you dirive from to</font>
00009 <font class="comment">                   create a fully functional server. The simple server</font>
00010 <font class="comment">                   class handles creating a listen socket, reading a full</font>
00011 <font class="comment">                   packet from a client connection, idling the server.</font>
00012 <font class="comment"></font>
00013 <font class="comment">                   You only need to override processSingleMsg() in order </font>
00014 <font class="comment">                   to process packets that come from a client socket.</font>
00015 <font class="comment">                   See the section "user overrideables" below for what </font>
00016 <font class="comment">                   methods you would tipically call.</font>
00017 <font class="comment"></font>
00018 <font class="comment">                   Override idle() method if you want to do things on a </font>
00019 <font class="comment">                   regular basis without waiting for a packet from a client.</font>
00020 <font class="comment"></font>
00021 <font class="comment">                   The two ways of constructing a simple server are for a </font>
00022 <font class="comment">                   single threaded server, and a multi threaded server.</font>
00023 <font class="comment"></font>
00024 <font class="comment">                   NOTE: Any shared data in your dirived classes should be </font>
00025 <font class="comment">                   in the SimpleManager and passed into the simple server. </font>
00026 <font class="comment">                   If you idle in the manager, you should idle the same way</font>
00027 <font class="comment">                   in the server. The simple server however should check if </font>
00028 <font class="comment">                   it is running multi threaded, and only idle shared data</font>
00029 <font class="comment">                   if it is running single threaded.</font>
00030 <font class="comment"></font>
00031 <font class="comment">*********************************************************************/</font>
00032 
00033 <font class="preprocessor">#ifndef SIMPLESERVER_H</font>
00034 <font class="preprocessor"></font><font class="preprocessor">#define SIMPLESERVER_H</font>
00035 <font class="preprocessor"></font>
00036 <font class="preprocessor">#ifdef _WIN32</font>
00037 <font class="preprocessor"></font><font class="preprocessor"># include &lt;time.h&gt;</font>
00038 <font class="preprocessor">#else</font>
00039 <font class="preprocessor"></font><font class="preprocessor"># include &lt;sys/time.h&gt;</font>
00040 <font class="preprocessor"># include &lt;unistd.h&gt;</font>
00041 <font class="preprocessor">#endif</font>
00042 <font class="preprocessor"></font>
00043 <font class="preprocessor">#include "<a class="code" href="packetbuffer_8h.html">packetbuffer.h</a>"</font>
00044 <font class="preprocessor">#include "<a class="code" href="flags_8h.html">flags.h</a>"</font>
00045 <font class="preprocessor">#include "<a class="code" href="linkedlist_8h.html">linkedlist.h</a>"</font>
00046 <font class="preprocessor">#include "<a class="code" href="bufferedsocket_8h.html">bufferedsocket.h</a>"</font>
00047 <font class="preprocessor">#include "<a class="code" href="threadutils_8h.html">threadutils.h</a>"</font>
00048 <font class="preprocessor">#include "<a class="code" href="packetmessageque_8h.html">packetmessageque.h</a>"</font>
00049 <font class="preprocessor">#include "<a class="code" href="serversocket_8h.html">serversocket.h</a>"</font>
00050 <font class="preprocessor">#include "<a class="code" href="simplemanager_8h.html">simplemanager.h</a>"</font>
00051 
00052 <font class="keyword">namespace </font>ssobjects
00053 {
00054 
<a name="l00055"></a><a class="code" href="simpleserver_8h.html#a0">00055</a> <font class="preprocessor">#define throwSimpleServerException(m) (throw SimpleServerException(m,__FILE__,__LINE__))</font>
00056 <font class="preprocessor"></font>
<a name="l00060"></a><a class="code" href="classssobjects_1_1SimpleServerException.html">00060</a> <font class="keyword">class </font>SimpleServerException : <font class="keyword">public</font> GeneralException
00061 {
00062   <font class="keyword">public</font>: <font class="comment">// Constructor/destructor</font>
<a name="l00063"></a><a class="code" href="classssobjects_1_1SimpleServerException.html#a0">00063</a>     <a class="code" href="classssobjects_1_1SimpleServerException.html#a0">SimpleServerException</a>(<font class="keywordtype">char</font>* pchMessage,<font class="keyword">const</font> <font class="keywordtype">char</font>* pFname,<font class="keyword">const</font> <font class="keywordtype">int</font> iLine) 
00064       : GeneralException(pchMessage,pFname,iLine){};
00065 };
00066 
00067 <font class="keyword">class </font>ServerSocket;
00068 <font class="keyword">class </font>ServerHandler;
00069 <font class="keyword">class </font>SimpleManager;
00070 
<a name="l00150"></a><a class="code" href="classssobjects_1_1SimpleServer.html">00150</a> <font class="keyword">class </font>SimpleServer : <font class="keyword">public</font> ThreadHandler
00151 {
00152     <font class="keyword">friend</font> SimpleManager;
00153 
00154   <font class="keyword">public</font>:
00155     <font class="keyword">enum</font> 
00156       {
00157       MIN_FREQ=10   
00158       };
00159 
00160   <font class="keyword">public</font>:     <font class="comment">//construction</font>
00161     <a class="code" href="classssobjects_1_1SimpleServer.html#a0">SimpleServer</a>(<font class="keyword">const</font> SockAddr&amp; saBind,
00162                  <font class="keyword">const</font> unsigned32 nFreq=1000,
00163                  <font class="keyword">const</font> unsigned32 nMaxConnections=100);   
00164     <a class="code" href="classssobjects_1_1SimpleServer.html#a0">SimpleServer</a>(ServerSocket* <font class="keyword">const</font> psocket,
00165                  <font class="keyword">const</font> unsigned32 nFreq);                 
00166     <font class="keyword">virtual</font> <a class="code" href="classssobjects_1_1SimpleServer.html#a2">~SimpleServer</a>();
00167         
00168   <font class="keyword">protected</font>:  <font class="comment">//user overridables</font>
00220 <font class="comment"></font>    <font class="keyword">virtual</font> <font class="keywordtype">void</font>    <a class="code" href="classssobjects_1_1SimpleServer.html#b0">processSingleMsg</a>(PacketMessage* pmsg) = 0;
00221 
<a name="l00223"></a><a class="code" href="classssobjects_1_1SimpleServer.html#b1">00223</a>     <font class="keyword">virtual</font> <font class="keywordtype">void</font>    <a class="code" href="classssobjects_1_1SimpleServer.html#b1">idle</a>(unsigned32 nTimer=0)<font class="keyword"> </font>{<a class="code" href="defs_8h.html#a12">UNUSED_ALWAYS</a>(nTimer);}
00224       
00225 
00226   <font class="keyword">public</font>:     <font class="comment">//server controls</font>
00227     <font class="keyword">virtual</font> <font class="keywordtype">void</font>    <a class="code" href="classssobjects_1_1SimpleServer.html#a3">startServer</a>();                                              
00228     <font class="keyword">virtual</font> <font class="keywordtype">void</font>    <a class="code" href="classssobjects_1_1SimpleServer.html#a4">killServer</a>();                                               
00229     <font class="keyword">virtual</font> <font class="keywordtype">void</font>    <a class="code" href="classssobjects_1_1SimpleServer.html#a5">pauseIncomingConnections</a>();                                 
00230     <font class="keyword">virtual</font> <font class="keywordtype">void</font>    <a class="code" href="classssobjects_1_1SimpleServer.html#a6">sendPacket</a>(ServerSocket* psocket,<font class="keyword">const</font> PacketBuffer&amp; packet);   
00231     <font class="keyword">virtual</font> <font class="keywordtype">void</font>    <a class="code" href="classssobjects_1_1SimpleServer.html#a6">sendPacket</a>(ServerSocket* psocket,<font class="keyword">const</font> PacketBuffer* ppacket);  
00232     <font class="keyword">virtual</font> <font class="keywordtype">void</font>    <a class="code" href="classssobjects_1_1SimpleServer.html#a8">send2All</a>(<font class="keyword">const</font> PacketBuffer&amp; packet);                           
00233     <font class="keyword">virtual</font> <font class="keywordtype">void</font>    <a class="code" href="classssobjects_1_1SimpleServer.html#a8">send2All</a>(<font class="keyword">const</font> PacketBuffer* ppacket);                          
00234     <font class="keyword">virtual</font> <font class="keywordtype">void</font>    <a class="code" href="classssobjects_1_1SimpleServer.html#a10">removeSocket</a>(ServerSocket* psocket);                        
00235 
00236   <font class="keyword">public</font>:
00237     <font class="keyword">static</font> <font class="keywordtype">bool</font>     <a class="code" href="classssobjects_1_1SimpleServer.html#d0">canBind</a>(SockAddr&amp; saBind);                                
00238     unsigned32      <a class="code" href="classssobjects_1_1SimpleServer.html#a11">getTicks</a>();                                                 
<a name="l00239"></a><a class="code" href="classssobjects_1_1SimpleServer.html#a12">00239</a>     <font class="keywordtype">bool</font>            <a class="code" href="classssobjects_1_1SimpleServer.html#a12">isThreaded</a>()<font class="keyword"> </font>{ <font class="keywordflow">return</font> m_bUsingThread; }                     
00240 
00241     <font class="comment">//nothing servicable beyond this point</font>
00242   <font class="keyword">protected</font>:
00243     threadReturn    <a class="code" href="classssobjects_1_1SimpleServer.html#b2">ThreadHandlerProc</a>(<font class="keywordtype">void</font>);                <font class="comment">//main handler routine</font>
00244     <font class="keywordtype">void</font>            <a class="code" href="classssobjects_1_1SimpleServer.html#b3">processMessages</a>();
00245     <font class="keywordtype">bool</font>            <a class="code" href="classssobjects_1_1SimpleServer.html#b4">processSockets</a>(<font class="keywordtype">int</font> iReady);
00246     <font class="keywordtype">void</font>            <a class="code" href="classssobjects_1_1SimpleServer.html#b5">processSelectError</a>();
00247     <font class="keywordtype">void</font>            <a class="code" href="classssobjects_1_1SimpleServer.html#b6">acceptConnection</a>();
00248     <font class="keywordtype">int</font>             <a class="code" href="classssobjects_1_1SimpleServer.html#b7">getMaxFD</a>();                             <font class="comment">//return highest connected sock fd</font>
00249     <font class="keywordtype">long</font>            <a class="code" href="classssobjects_1_1SimpleServer.html#b8">getSleepTime</a>();                         <font class="comment">//how many usecs to sleep according to idle frequency</font>
<a name="l00250"></a><a class="code" href="classssobjects_1_1SimpleServer.html#b9">00250</a>     <font class="keywordtype">void</font>            <a class="code" href="classssobjects_1_1SimpleServer.html#b9">addMsg</a>(PacketMessage* pmsg)<font class="keyword"> </font>{ m_que.add(pmsg); }
00251     <font class="keywordtype">void</font>            <a class="code" href="classssobjects_1_1SimpleServer.html#b10">queClosedMessage</a>(ServerSocket* psocketRemoving);
00252 
00253   <font class="keyword">private</font>:    <font class="comment">//unused overrides</font>
00254     <a class="code" href="classssobjects_1_1SimpleServer.html#a0">SimpleServer</a>(<font class="keyword">const</font> SimpleServer&amp; server);
00255     SimpleServer&amp; <a class="code" href="classssobjects_1_1ThreadHandler.html#b1">operator=</a>(<font class="keyword">const</font> SimpleServer&amp; server);
00256         
00257   <font class="keyword">protected</font>:
<a name="l00258"></a><a class="code" href="classssobjects_1_1SimpleServer.html#n0">00258</a>     SocketInstance          m_sListen;
<a name="l00259"></a><a class="code" href="classssobjects_1_1SimpleServer.html#n1">00259</a>     SockAddr                m_saServer;
<a name="l00260"></a><a class="code" href="classssobjects_1_1SimpleServer.html#n2">00260</a>     LinkedList&lt;ServerSocket&gt;    m_listClients;
<a name="l00261"></a><a class="code" href="classssobjects_1_1SimpleServer.html#n3">00261</a>     PacketMessageQue        m_que;
<a name="l00262"></a><a class="code" href="classssobjects_1_1SimpleServer.html#n4">00262</a>     unsigned32              m_nIdleFrequency;       <font class="comment">//how often idle will be called</font>
<a name="l00263"></a><a class="code" href="classssobjects_1_1SimpleServer.html#n5">00263</a>     unsigned32              m_nMaxCon;
<a name="l00264"></a><a class="code" href="classssobjects_1_1SimpleServer.html#n6">00264</a>     <font class="keywordtype">bool</font>                    m_bUsingThread;
<a name="l00265"></a><a class="code" href="classssobjects_1_1SimpleServer.html#n7">00265</a>     <font class="keywordtype">bool</font>                    m_bPause;      
<a name="l00266"></a><a class="code" href="classssobjects_1_1SimpleServer.html#n8">00266</a>     unsigned32              m_nSleepTime;
<a name="l00267"></a><a class="code" href="classssobjects_1_1SimpleServer.html#n9">00267</a>     <font class="keyword">struct </font><a class="code" href="classtimeval.html">timeval</a>          m_tvServerStarted;
<a name="l00268"></a><a class="code" href="classssobjects_1_1SimpleServer.html#n11">00268</a>     fd_set                  m_rset,m_wset;
00269 };
00270 
00271 };
00272 
00273 <font class="preprocessor">#endif //SIMPLESERVER_H</font>
</font></pre></div><hr><address><small>Generated at Tue Sep 25 00:26:36 2001 for SimpleServerObjects by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.7 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2001</small></address>
</body>
</html>
